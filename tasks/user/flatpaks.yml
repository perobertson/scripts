---
- name: All - Add the flathub flatpak repository remote to the user installation
  flatpak_remote:
    name: flathub
    state: present
    flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo
    method: user

- name: All - Create user systemd config directory
  file:
    path: $HOME/.config/systemd/user
    state: directory
    mode: '0755'

- name: All - Add flatpak auto updates
  diff: true
  copy:
    src: files/home/user/.config/systemd/user/{{ item }}
    dest: $HOME/.config/systemd/user/{{ item }}
    mode: '0644'
  loop:
    - flatpak-update.service
    - flatpak-update.timer

- name: All - Check if dockerenv exists
  stat:
    path: /.dockerenv
  register: file_dockerenv

- name: All - Install flatpaks
  flatpak:
    name: "{{ item }}"
    state: present
    method: user
  loop:
    - com.discordapp.Discord
    - com.slack.Slack
    - com.spotify.Client
    - org.videolan.VLC
  register: flatpak_install
  until: flatpak_install is succeeded
  retries: 5
  delay: 5
  when: not file_dockerenv.stat.exists
