#!/usr/bin/env bash
set -euo pipefail

SOURCE=https://github.com/pyenv/pyenv.git
PYENV_ROOT="${HOME}/.local/lib/pyenv"

if [[ ! -d "${PYENV_ROOT}" ]]; then
    git clone \
        --single-branch \
        "${SOURCE}" \
        "${PYENV_ROOT}"
    cd "${PYENV_ROOT}"
else
    cd "${PYENV_ROOT}"
    git pull --rebase --stat
fi

# link the bins to the PATH
for bin in "${PYENV_ROOT}/bin/"*; do
    bin=$(basename "${bin}")
    if [[ ! -x "${HOME}/.local/bin/${bin}" ]]; then
        ln -s "${PYENV_ROOT}/bin/${bin}" "${HOME}/.local/bin/${bin}"
    fi
done
